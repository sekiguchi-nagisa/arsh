# empty
assert shctl
assert "$(shctl 2>&1)" == ""

# undefined subcommand
shctl hogera
assert $? == 2
assert "$(shctl hoge 2>&1)" == "ydsh: shctl: undefined subcommand: hoge"

# source
shctl is-sourced
assert $? == 1
command shctl is-sourced
assert $? == 1
eval shctl is-sourced
assert $? == 1

source ../../_module4test/sourced.ds as S
assert $S.SOURCED == 0
assert $S.sourced() == 0

function f() : Int {
    $? = 0
    shctl is-sourced
    return $?
}
assert $f() == 1

# function
function gg() : String {
    return "$(shctl function)"
}

cc() {
    shctl function
}
assert $gg() == "gg"
assert cc
assert $? == 0
assert "$(cc)" == "cc"
assert "$(shctl function)" == "<toplevel>"
shctl function
assert $? == 1

# interactive
$? = 0
shctl is-interactive
assert $? == 1
assert shctl backtrace

# info
assert $reply.empty()
assert shctl info | grep regex | grep PCRE2
assert shctl info | grep version | grep $YDSH_VERSION
assert shctl info | grep compiler
$? = 0
assert shctl info
assert !$reply.empty()
assert !$reply['regex'].empty()
assert $reply['regex'] =~ $/PCRE2 \d+\.\d+/
assert $reply['version'] == $YDSH_VERSION
assert !$reply['compiler'].empty()