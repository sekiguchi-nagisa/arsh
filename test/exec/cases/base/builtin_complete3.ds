
function assertArray($x : Array<String>, $y : Array<String>) {
    assert diff <(for $a in $x { echo $a; }) <(for $a in $y { echo $a; })
}

function assertEmptyComp($s : String) {
    assert complete $s > /dev/null
    assert $COMPREPLY.size() == 1
    assert $COMPREPLY[0].empty()
}


# complete expected token
$assertArray([')'], $(complete 'for(var i = 0; $i < 23; $i++ '))
$assertArray(['='], $(complete '34; var a '))
$assertArray([')'], $(complete '$(echo $TRUE '))
# $assertArray([";"], $(complete '(ls) '))

# complete keyword
$assertArray(["{"], $(complete '{'))
$assertArray(["source", "source!"], $(complete 'sour'))
$assertArray(["source", "source!"], $(complete 'source'))
$assertArray(["import-env"], $(complete 'import-e'))
$assertArray(["assert"], $(complete 'asser'))

# complete empty token
$assertArray([")"], $(complete 'for(var i = 0; $i < 23; $i++'))
$assertEmptyComp('34; var a')
$assertEmptyComp('echo &&')
$assertEmptyComp('echo >')