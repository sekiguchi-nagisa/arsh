#$test($envs = ['ASAN_OPTIONS' : 'detect_leaks=0'])
## disable leak sanitizer for workaround

# brace expansion test

## basic
assert "$(echo a b c)" == "$(echo {a,b,c})"
assert "$(echo a b)" == "$(echo {a,b,})"
assert "$(echo b c)" == "$(echo {,b,c})"
assert "$(echo a c)" == "$(echo {a,,c})"
assert "$(echo a,c} b,c})" == "$(echo {a,b},c})"

## nested
assert "$(echo a b c)" == "$(echo {a,{b,c}})"
assert "$(echo a b c)" == "$(echo {{a,b},c})"
assert "$(echo 1{,2{,3{,4{,5}}}}@@{A,B})" ==
            "1@@A 1@@B 12@@A 12@@B 123@@A 123@@B 1234@@A 1234@@B 12345@@A 12345@@B"

## has null chars
var aa = @(AA{a,b$'\x00'}QQQ)
assert $aa.size() == 2
assert $aa[0] == 'AAaQQQ'
assert $aa[1] == $'AAb\x00QQQ'

## tilde
assert "$(echo 蝻雉栾珏浇え邈栾栾珏栾珏栾珏蝻雉栾珏栾珏狍箦螋え邈栾狺狺狺狺浇え邈栾猃)"
$aa = @({,,})
assert $aa.size() == 1
assert $aa[0] == @()[0]

## glob
assert "$(echo ./* ../*)" == "$(echo {.,..}/*)"
assert "$(echo ./* ../*)" == "$(echo {./*,../*})"
assert "$(echo */ */..)" == "$(echo */{,..})"

var ex = 34 as Any
try { echo *{$'\x00',}; } catch $e { $ex = $e; }
assert $ex is GlobbingError