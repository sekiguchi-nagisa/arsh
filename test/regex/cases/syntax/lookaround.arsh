
source $SCRIPT_DIR/test_helper.arsh

# (?=
assert diff <(redump '(?=' '') <(<<'EOF'
1:4 [error] unclosed group
 at (pos = 3, size = 0)
EOF
)

# (?=)
assert diff <(redump '(?=)' '') <(<<'EOF'
flag: (mode = , modifier = )
captureGroupCount: 0
namedCaptureGroups: []
pattern:
  kind: LookAround
  token: (pos = 0, size = 4)
  type: LOOK_AHEAD
  pattern:
    kind: Empty
    token: (pos = 3, size = 0)
EOF
)

# (?=|)
assert diff <(redump '(?=|)' '') <(<<'EOF'
flag: (mode = , modifier = )
captureGroupCount: 0
namedCaptureGroups: []
pattern:
  kind: LookAround
  token: (pos = 0, size = 5)
  type: LOOK_AHEAD
  pattern:
    kind: Alt
    token: (pos = 3, size = 1)
    patterns:
      - kind: Empty
        token: (pos = 3, size = 0)
      - kind: Empty
        token: (pos = 4, size = 0)
EOF
)

# (?=ab)
assert diff <(redump '(?=ab)' '') <(<<'EOF'
flag: (mode = , modifier = )
captureGroupCount: 0
namedCaptureGroups: []
pattern:
  kind: LookAround
  token: (pos = 0, size = 6)
  type: LOOK_AHEAD
  pattern:
    kind: Seq
    token: (pos = 3, size = 2)
    patterns:
      - kind: Char
        token: (pos = 3, size = 1)
        codePoint: U+0061, a
      - kind: Char
        token: (pos = 4, size = 1)
        codePoint: U+0062, b
EOF
)

# (?!
assert diff <(redump '(?!' '') <(<<'EOF'
1:4 [error] unclosed group
 at (pos = 3, size = 0)
EOF
)

# (?!)
assert diff <(redump '(?!)' 'u') <(<<'EOF'
flag: (mode = u, modifier = )
captureGroupCount: 0
namedCaptureGroups: []
pattern:
  kind: LookAround
  token: (pos = 0, size = 4)
  type: LOOK_AHEAD_NOT
  pattern:
    kind: Empty
    token: (pos = 3, size = 0)
EOF
)

# (?!(?!a))
assert diff <(redump '(?!(?!a))' 'u') <(<<'EOF'
flag: (mode = u, modifier = )
captureGroupCount: 0
namedCaptureGroups: []
pattern:
  kind: LookAround
  token: (pos = 0, size = 9)
  type: LOOK_AHEAD_NOT
  pattern:
    kind: LookAround
    token: (pos = 3, size = 5)
    type: LOOK_AHEAD_NOT
    pattern:
      kind: Char
      token: (pos = 6, size = 1)
      codePoint: U+0061, a
EOF
)

# (?<
assert diff <(redump '(?<' '') <(<<'EOF'
1:3 [error] capture group name must contain valid identifier: `'
 at (pos = 2, size = 1)
EOF
)

# (?<=
assert diff <(redump '(?<=' '') <(<<'EOF'
1:5 [error] unclosed group
 at (pos = 4, size = 0)
EOF
)

# (?<=)
assert diff <(redump '(?<=)' '') <(<<'EOF'
flag: (mode = , modifier = )
captureGroupCount: 0
namedCaptureGroups: []
pattern:
  kind: LookAround
  token: (pos = 0, size = 5)
  type: LOOK_BEHIND
  pattern:
    kind: Empty
    token: (pos = 4, size = 0)
EOF
)

# (?<=|)
assert diff <(redump '(?<=|)' '') <(<<'EOF'
flag: (mode = , modifier = )
captureGroupCount: 0
namedCaptureGroups: []
pattern:
  kind: LookAround
  token: (pos = 0, size = 6)
  type: LOOK_BEHIND
  pattern:
    kind: Alt
    token: (pos = 4, size = 1)
    patterns:
      - kind: Empty
        token: (pos = 4, size = 0)
      - kind: Empty
        token: (pos = 5, size = 0)
EOF
)

# (?<!
assert diff <(redump '(?<!' '') <(<<'EOF'
1:5 [error] unclosed group
 at (pos = 4, size = 0)
EOF
)

# (?<!)
assert diff <(redump '(?<!)' '') <(<<'EOF'
flag: (mode = , modifier = )
captureGroupCount: 0
namedCaptureGroups: []
pattern:
  kind: LookAround
  token: (pos = 0, size = 5)
  type: LOOK_BEHIND_NOT
  pattern:
    kind: Empty
    token: (pos = 4, size = 0)
EOF
)