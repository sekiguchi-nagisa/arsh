
source $SCRIPT_DIR/test_helper.arsh

# ()\00
assert diff <(redump '()\00' '') <(<<'EOF'
flag: (mode = , modifier = )
captureGroupCount: 1
namedCaptureGroups: []
pattern:
  kind: Seq
  token: (pos = 0, size = 5)
  patterns:
    - kind: Group
      token: (pos = 0, size = 2)
      group: CAPTURE
      index: 1
      setModifiers:
      unsetModifiers:
      pattern:
        kind: Empty
        token: (pos = 1, size = 0)
    - kind: Char
      token: (pos = 2, size = 3)
      codePoint: U+0000, \x00
EOF
)

assert diff <(redump '()\00' 'u') <(<<'EOF'
1:3 [error] invalid decimal escape: `00'
 at (pos = 2, size = 3)
EOF
)

# ()\1
assert diff <(redump '()\1' '') <(<<'EOF'
flag: (mode = , modifier = )
captureGroupCount: 1
namedCaptureGroups: []
pattern:
  kind: Seq
  token: (pos = 0, size = 4)
  patterns:
    - kind: Group
      token: (pos = 0, size = 2)
      group: CAPTURE
      index: 1
      setModifiers:
      unsetModifiers:
      pattern:
        kind: Empty
        token: (pos = 1, size = 0)
    - kind: BackRef
      token: (pos = 2, size = 2)
      name:
      index: 1
EOF
)

assert diff <(redump '()\1' 'u') <(<<'EOF'
flag: (mode = u, modifier = )
captureGroupCount: 1
namedCaptureGroups: []
pattern:
  kind: Seq
  token: (pos = 0, size = 4)
  patterns:
    - kind: Group
      token: (pos = 0, size = 2)
      group: CAPTURE
      index: 1
      setModifiers:
      unsetModifiers:
      pattern:
        kind: Empty
        token: (pos = 1, size = 0)
    - kind: BackRef
      token: (pos = 2, size = 2)
      name:
      index: 1
EOF
)

# ()\2
assert diff <(redump '()\2' '') <(<<'EOF'
flag: (mode = , modifier = )
captureGroupCount: 1
namedCaptureGroups: []
pattern:
  kind: Seq
  token: (pos = 0, size = 4)
  patterns:
    - kind: Group
      token: (pos = 0, size = 2)
      group: CAPTURE
      index: 1
      setModifiers:
      unsetModifiers:
      pattern:
        kind: Empty
        token: (pos = 1, size = 0)
    - kind: Char
      token: (pos = 2, size = 2)
      codePoint: U+0002, \x02
EOF
)

assert diff <(redump '()\2' 'v') <(<<'EOF'
1:3 [error] backref index is greater than capture group count: `2'
 at (pos = 2, size = 2)
EOF
)

# ()\3()\(()
assert diff <(redump '()\3()\(()' '') <(<<'EOF'
flag: (mode = , modifier = )
captureGroupCount: 3
namedCaptureGroups: []
pattern:
  kind: Seq
  token: (pos = 0, size = 10)
  patterns:
    - kind: Group
      token: (pos = 0, size = 2)
      group: CAPTURE
      index: 1
      setModifiers:
      unsetModifiers:
      pattern:
        kind: Empty
        token: (pos = 1, size = 0)
    - kind: BackRef
      token: (pos = 2, size = 2)
      name:
      index: 3
    - kind: Group
      token: (pos = 4, size = 2)
      group: CAPTURE
      index: 2
      setModifiers:
      unsetModifiers:
      pattern:
        kind: Empty
        token: (pos = 5, size = 0)
    - kind: Char
      token: (pos = 6, size = 2)
      codePoint: U+0028, (
    - kind: Group
      token: (pos = 8, size = 2)
      group: CAPTURE
      index: 3
      setModifiers:
      unsetModifiers:
      pattern:
        kind: Empty
        token: (pos = 9, size = 0)
EOF
)

assert diff <(redump '()\3()\(()' 'v') <(<<'EOF'
flag: (mode = v, modifier = )
captureGroupCount: 3
namedCaptureGroups: []
pattern:
  kind: Seq
  token: (pos = 0, size = 10)
  patterns:
    - kind: Group
      token: (pos = 0, size = 2)
      group: CAPTURE
      index: 1
      setModifiers:
      unsetModifiers:
      pattern:
        kind: Empty
        token: (pos = 1, size = 0)
    - kind: BackRef
      token: (pos = 2, size = 2)
      name:
      index: 3
    - kind: Group
      token: (pos = 4, size = 2)
      group: CAPTURE
      index: 2
      setModifiers:
      unsetModifiers:
      pattern:
        kind: Empty
        token: (pos = 5, size = 0)
    - kind: Char
      token: (pos = 6, size = 2)
      codePoint: U+0028, (
    - kind: Group
      token: (pos = 8, size = 2)
      group: CAPTURE
      index: 3
      setModifiers:
      unsetModifiers:
      pattern:
        kind: Empty
        token: (pos = 9, size = 0)
EOF
)

# ()\888888888888888888888888
assert diff <(redump '()\888888888888888888888888' '') <(<<'EOF'
flag: (mode = , modifier = )
captureGroupCount: 1
namedCaptureGroups: []
pattern:
  kind: Seq
  token: (pos = 0, size = 27)
  patterns:
    - kind: Group
      token: (pos = 0, size = 2)
      group: CAPTURE
      index: 1
      setModifiers:
      unsetModifiers:
      pattern:
        kind: Empty
        token: (pos = 1, size = 0)
    - kind: Char
      token: (pos = 2, size = 2)
      codePoint: U+0038, 8
    - kind: Char
      token: (pos = 4, size = 1)
      codePoint: U+0038, 8
    - kind: Char
      token: (pos = 5, size = 1)
      codePoint: U+0038, 8
    - kind: Char
      token: (pos = 6, size = 1)
      codePoint: U+0038, 8
    - kind: Char
      token: (pos = 7, size = 1)
      codePoint: U+0038, 8
    - kind: Char
      token: (pos = 8, size = 1)
      codePoint: U+0038, 8
    - kind: Char
      token: (pos = 9, size = 1)
      codePoint: U+0038, 8
    - kind: Char
      token: (pos = 10, size = 1)
      codePoint: U+0038, 8
    - kind: Char
      token: (pos = 11, size = 1)
      codePoint: U+0038, 8
    - kind: Char
      token: (pos = 12, size = 1)
      codePoint: U+0038, 8
    - kind: Char
      token: (pos = 13, size = 1)
      codePoint: U+0038, 8
    - kind: Char
      token: (pos = 14, size = 1)
      codePoint: U+0038, 8
    - kind: Char
      token: (pos = 15, size = 1)
      codePoint: U+0038, 8
    - kind: Char
      token: (pos = 16, size = 1)
      codePoint: U+0038, 8
    - kind: Char
      token: (pos = 17, size = 1)
      codePoint: U+0038, 8
    - kind: Char
      token: (pos = 18, size = 1)
      codePoint: U+0038, 8
    - kind: Char
      token: (pos = 19, size = 1)
      codePoint: U+0038, 8
    - kind: Char
      token: (pos = 20, size = 1)
      codePoint: U+0038, 8
    - kind: Char
      token: (pos = 21, size = 1)
      codePoint: U+0038, 8
    - kind: Char
      token: (pos = 22, size = 1)
      codePoint: U+0038, 8
    - kind: Char
      token: (pos = 23, size = 1)
      codePoint: U+0038, 8
    - kind: Char
      token: (pos = 24, size = 1)
      codePoint: U+0038, 8
    - kind: Char
      token: (pos = 25, size = 1)
      codePoint: U+0038, 8
    - kind: Char
      token: (pos = 26, size = 1)
      codePoint: U+0038, 8
EOF
)

# ()\888888888888888888888888
assert diff <(redump '()\888888888888888888888888' 'u') <(<<'EOF'
1:3 [error] backref index is greater than capture group count: `888888888888888888888888'
 at (pos = 2, size = 25)
EOF
)