
source $SCRIPT_DIR/test_helper.arsh

# あ?
assert diff <(redump 'あ?' '') <(<<'EOF'
flag: (mode = , modifier = )
captureGroupCount: 0
namedCaptureGroups: []
pattern:
  kind: Repeat
  token: (pos = 0, size = 4)
  repeat: (min = 0, max = 1)
  greedy: true
  pattern:
    kind: Char
    token: (pos = 0, size = 3)
    codePoint: U+3042, あ
EOF
)

assert diff <(redump 'あ?' 'u') <(<<'EOF'
flag: (mode = u, modifier = )
captureGroupCount: 0
namedCaptureGroups: []
pattern:
  kind: Repeat
  token: (pos = 0, size = 4)
  repeat: (min = 0, max = 1)
  greedy: true
  pattern:
    kind: Char
    token: (pos = 0, size = 3)
    codePoint: U+3042, あ
EOF
)

assert diff <(redump '\u{3042}?' '') <(<<'EOF'
flag: (mode = , modifier = )
captureGroupCount: 0
namedCaptureGroups: []
pattern:
  kind: Repeat
  token: (pos = 0, size = 9)
  repeat: (min = 3042, max = 3042)
  greedy: false
  pattern:
    kind: Char
    token: (pos = 0, size = 2)
    codePoint: U+0075, u
EOF
)

assert diff <(redump '\u{3042}?' 'u') <(<<'EOF'
flag: (mode = u, modifier = )
captureGroupCount: 0
namedCaptureGroups: []
pattern:
  kind: Repeat
  token: (pos = 0, size = 9)
  repeat: (min = 0, max = 1)
  greedy: true
  pattern:
    kind: Char
    token: (pos = 0, size = 8)
    codePoint: U+3042, あ
EOF
)

# あ??
assert diff <(redump ' あ??' '') <(<<'EOF'
flag: (mode = , modifier = )
captureGroupCount: 0
namedCaptureGroups: []
pattern:
  kind: Seq
  token: (pos = 0, size = 6)
  patterns:
    - kind: Char
      token: (pos = 0, size = 1)
      codePoint: U+0020, \x20
    - kind: Repeat
      token: (pos = 1, size = 5)
      repeat: (min = 0, max = 1)
      greedy: false
      pattern:
        kind: Char
        token: (pos = 1, size = 3)
        codePoint: U+3042, あ
EOF
)

assert diff <(redump ' あ??' 'v') <(<<'EOF'
flag: (mode = v, modifier = )
captureGroupCount: 0
namedCaptureGroups: []
pattern:
  kind: Seq
  token: (pos = 0, size = 6)
  patterns:
    - kind: Char
      token: (pos = 0, size = 1)
      codePoint: U+0020, \x20
    - kind: Repeat
      token: (pos = 1, size = 5)
      repeat: (min = 0, max = 1)
      greedy: false
      pattern:
        kind: Char
        token: (pos = 1, size = 3)
        codePoint: U+3042, あ
EOF
)

# a*
assert diff <(redump 'a*' '') <(<<'EOF'
flag: (mode = , modifier = )
captureGroupCount: 0
namedCaptureGroups: []
pattern:
  kind: Repeat
  token: (pos = 0, size = 2)
  repeat: (min = 0, max = unlimited)
  greedy: true
  pattern:
    kind: Char
    token: (pos = 0, size = 1)
    codePoint: U+0061, a
EOF
)

# a*?
assert diff <(redump 'a*?' '') <(<<'EOF'
flag: (mode = , modifier = )
captureGroupCount: 0
namedCaptureGroups: []
pattern:
  kind: Repeat
  token: (pos = 0, size = 3)
  repeat: (min = 0, max = unlimited)
  greedy: false
  pattern:
    kind: Char
    token: (pos = 0, size = 1)
    codePoint: U+0061, a
EOF
)

# a**
assert diff <(redump 'a**' '') <(<<'EOF'
1:3 [error] `*' quantifier does not follow atom
 at (pos = 2, size = 1)
EOF
)

assert diff <(redump 'a**' 'u') <(<<'EOF'
1:3 [error] `*' quantifier does not follow atom
 at (pos = 2, size = 1)
EOF
)

# \w+
assert diff <(redump '\w+' '') <(<<'EOF'
flag: (mode = , modifier = )
captureGroupCount: 0
namedCaptureGroups: []
pattern:
  kind: Repeat
  token: (pos = 0, size = 3)
  repeat: (min = 1, max = unlimited)
  greedy: true
  pattern:
    kind: Property
    token: (pos = 0, size = 2)
    property: WORD
    value: 0
    invert: false
EOF
)

# .+?
assert diff <(redump '.+?' 'v') <(<<'EOF'
flag: (mode = v, modifier = )
captureGroupCount: 0
namedCaptureGroups: []
pattern:
  kind: Repeat
  token: (pos = 0, size = 3)
  repeat: (min = 1, max = unlimited)
  greedy: false
  pattern:
    kind: Any
    token: (pos = 0, size = 1)
EOF
)

assert diff <(redump '\b*?' '') <(<<'EOF'
1:3 [error] `*' quantifier does not follow atom
 at (pos = 2, size = 1)
EOF
)

assert diff <(redump '\b*?' 'u') <(<<'EOF'
1:3 [error] `*' quantifier does not follow atom
 at (pos = 2, size = 1)
EOF
)

assert diff <(redump '\B?' '') <(<<'EOF'
1:3 [error] `?' quantifier does not follow atom
 at (pos = 2, size = 1)
EOF
)

assert diff <(redump '^+' '') <(<<'EOF'
1:2 [error] `+' quantifier does not follow atom
 at (pos = 1, size = 1)
EOF
)